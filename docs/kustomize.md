# Working with Kustomize 

Monokle has built-in support for [Kustomize](https://kustomize.io/) - a popular tool for managing kubernetes configurations:

- Monokle can visualize dependencies and relationships between kustomize files to help you understand the scope of
  a specific kustomization
- Monokle can preview resources generated by Kustomize, helping you debug your configurations before you deploy them to 
  your cluster (requires kubectl to be installed and configured in your PATH)

(all examples below are from the [Argo Rollouts manifest folder](https://github.com/argoproj/argo-rollouts/tree/master/manifests) - clone and try these yourself!)

## Kustomize Navigation

When selecting a folder containing kustomization.yaml files, these will automatically be displayed in a "Kustomizations" section 
on top of the Navigator:

![Kustomize Navigation](img/kustomize-navigation.png)

In the screenshot:

- the Kustomizations section shows all kustomization.yaml files - named after the folder they are in relative to the selected root folder
- the "base" kustomization.yaml has been selected
    - the corresponding kustomization.yaml file has been highlighted to the left
    - all "downstream" kustomizations and included resources are highlighted in the Navigator, helping you understand the "scope" of the selected kustomization
    - the content of the kustomzation resource is shown in the Source editor to the right, with corresponding resource links marked in the code

Just as with K8s resources, hovering over the link-icon to the right of the kustomization name shows its outgoing links:

![Kustomize Outgoing Links](img/kustomize-outgoing-links.png)

(here we can see the 7 resources included by the selected kustomization)

and hovering the link-icon to the left of the kustomization name shows its incoming links:

![Kustomize Incoming Links](img/kustomize-incoming-links.png)  

(here we see two "upstream" kustomizations that include the selected kustomization in their configuration)

## Kustomize Preview 

While the above helps you understand the relationships and dependencies between kustomizations and their included resources, the
Preview functionality helps you understand what resources would be installed in your cluster when running kustomize.

Hovering over a kustomization reveals a "Preview" action to the right:

![Kustomize Preview Action](img/kustomize-preview-action.png)

Selecting this action will run kustomize on the selected file with the "-k" option and replace the contents of the Navigator with the 
generated resources.  

For example previewing the "base" kustomization above will result in the following:

![Kustomize Preview](img/kustomize-preview.png)

Monokle is now in "Preview Mode" (as indicated by the header at the top):

- the File Explorer has been disabled
- the Navigator now contains all resources generated by running Kustomize with the "base" kustomization:
    - resource navigation works as with files; selecting a resource shows its content in the source editor in read-only mode
    - resource links are shown as before with corresponding popups/links/etc.
- selecting "Preview" for a different kustomization will preview the output of kustomize for that resource instead
- selecting "Exit" in the top right or next to the kustomization restores the previous resource navigator.

In the screenshot we can see that the selected kustomization resulted in 7 resources - and that they contain references to the image
specified in the kustomization configuration:

![Kustomize Preview Content](img/kustomize-preview-content.png)

